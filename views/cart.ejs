<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/5.0.0/mdb.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/styles/home.css">
  <link rel="stylesheet" href="/styles/header-footer.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/styles/cart.css">
  <title>AppApp Cart</title>
</head>

<body>
  <!-- Navbar -->
  <header class="navbar navbar-expand-lg navbar-light bg-body-tertiary">
    <nav class="container-fluid">
       <!-- Left elements -->
       <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- Logo -->
          <a class="navbar-brand mt-2 mt-lg-0" href="#">
          <img
             src="/images/logo.png"
             height="50"
             alt="MDB Logo"
             href="/"
             />
          </a>
          <!-- Left links -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
             <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
             </li>
             <li class="nav-item">
                <a class="nav-link" href="/home/nearMe">Near Me</a>
             </li>
             <li id="admin-button" class="nav-item">
                <a class="nav-link" href="/adminPage">Admin Page</a>
             </li>
          </ul>
       </div>
       <!-- Right elements -->
       <div class="d-flex align-items-center position-relative">
          <!-- Cart -->
          <a id="cart-link" class="link-secondary me-3" href="#">
          <i class="fas fa-shopping-cart fa-2x"></i>
          </a>
          <!-- Avatar -->
          <div class="dropdown">
             <a class="dropdown-toggle d-flex align-items-center hidden-arrow link-secondary"
                href="#" id="navbarDropdownMenuAvatar" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">
             <i class="fas fa-user-circle fa-2x"></i>
             </a>
             <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuAvatar">
                <li><a class="dropdown-item" href="#">My profile</a></li>
                <li><a class="dropdown-item" href="#">My orders</a></li>
                <li><a class="dropdown-item" href="/logout">Logout</a></li>
             </ul>
          </div>
       </div>
    </nav>
 </header>
 <!-- Cart -->
  <div class="shopping-cart">
    <div class="title"> <%= customer.firstName %>'s Shopping Cart </div>
    <!-- All cart items -->
    <ul>
      <% customer.cart.forEach(function(item) { 
        const workout = workouts.find(workout => workout._id.toString() === item.id);
    %>
      <div class="item">
        <span class="delete-btn" data-id="<%= item.id %>">
          <button><i class="bi bi-x-lg delete-icon"></i></button>
        </span>

        <div class="image">
          <img src="/images/<%= workout.image %>" alt="" />
        </div>

        <div class="description">
          <span><%= workout.name %></span>
          <span><%= workout.description %></span>
        </div>

        <div class="total-price"><%= workout.price %>₪</div>
      </div>

      <% }); %>
    </ul>
    <br>
    <div class="text-center">
      <button type="button" class="btn btn-light">Checkout</button>
    </div>
  </div>
  <!-- Footer -->
  <footer class="text-white text-center text-lg-start">
    <!-- Info -->
    <div id="first-footer" class="container p-4">
       <div class="row">
          <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
             <h5 class="text-uppercase">Talk To Us</h5>
             <p>
                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Iste
                atque ea quis molestias. Fugiat pariatur maxime quis culpa
                corporis vitae repudiandae aliquam voluptatem veniam, est atque
                cumque eum delectus sint!
             </p>
          </div>
          <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
             <h5 class="text-uppercase">About Us</h5>
             <p>
                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Iste
                atque ea quis molestias. Fugiat pariatur maxime quis culpa
                corporis vitae repudiandae aliquam voluptatem veniam, est atque
                cumque eum delectus sint!
             </p>
          </div>
       </div>
    </div>
    <!-- Copyright -->
    <div id="second-footer" class="text-center p-3">
       © 2024 Copyright: Us
    </div>
 </footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<!-- <script src="js/cart.js"></script> -->
 <script>
  async function deleteFromCart(workoutId) {
    try {
        const response = await fetch('/getSessionUsername');
        const data = await response.json();
        const username = data.username;
        console.log("delete");
        console.log(workoutId);

        // Send API request to remove workout from cart
        // const deleteResponse = await fetch('/api/removeFromCart', {
        //     method: 'POST',
        //     headers: {
        //         'Content-Type': 'application/json'
        //     },
        //     body: JSON.stringify({ username: username, workoutId: workoutId })
        // });

        // if (deleteResponse.ok) {
        //     console.log('Workout removed from cart successfully');
        //     // Optionally, remove the item from the DOM
        //     document.querySelector(`.cart-item[data-id="${workoutId}"]`).remove();
        // } else {
        //     console.error('Failed to remove workout from cart');
        // }
    } catch (error) {
        console.error('Error:', error);
    }
}


// Delete Listener
document.querySelectorAll('.delete-icon').forEach(icon => {
    icon.addEventListener('click', function(event) {
        event.preventDefault(); 
        const workoutId = event.target.closest('.delete-btn').getAttribute('data-id');
        deleteFromCart(workoutId);
    });
});
 </script>

</html>